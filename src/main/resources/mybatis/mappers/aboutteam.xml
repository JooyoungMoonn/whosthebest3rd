<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dc.human.whosthebest.aboutteam.dao.TeamDAO">
    <!-- game ResultMap -->
    <resultMap id="gameResultMap" type="GameVO">
        <id property="gID" column="G_ID"/>
        <result property="gTeamID" column="G_TEAMID"/>
        <result property="gTitle" column="G_TITLE"/>
        <result property="gTag" column="G_TAG"/>
        <result property="gCreatedDate" column="G_CREATEDATE"/>
        <result property="gTime" column="G_TIME"/>
        <result property="gInfo" column="G_INFO"/>
        <result property="gMinMember" column="G_MINMEMBER"/>
        <result property="gResDate" column="G_RESDATE"/>
        <result property="gStatus" column="G_STATUS"/>
        <result property="tUserID" column="T_USERID"/>
        <result property="tAwayID" column="T_AWAYID"/>
        <result property="sID" column="S_ID"/>
        <result property="sNum" column="S_NUM"/>
    </resultMap>

    <!-- gameList resultMap -->
    <resultMap id="gameListResultMap" type="GameListVO">
        <!-- game table -->
        <id property="gID" column="G_ID"/>
        <result property="gTeamID" column="G_TEAMID"/>
        <result property="gTitle" column="G_TITLE"/>
        <result property="gTag" column="G_TAG"/>
        <result property="gCreatedDate" column="G_CREATEDATE"/>
        <result property="gTime" column="G_TIME"/>
        <result property="gMinMember" column="G_MINMEMBER"/>
        <result property="gResDate" column="G_RESDATE"/>
        <result property="gStatus" column="G_STATUS"/>
        <result property="tUserID" column="G_USER_ID"/>
        <result property="sID" column="S_ID"/>
        <result property="sNum" column="S_NUM"/>

        <!-- team table -->
        <result property="tName" column="T_NAME"/>
        <result property="tLogo" column="T_LOGO"/>

        <!-- stadium table -->
        <result property="sName" column="S_NAME"/>
        <result property="sRegion" column="S_REGION"/>
        <result property="sAddr" column="S_ADDR"/>
    </resultMap>

    <select id="selectGameSchedule" parameterType="int" resultMap="gameListResultMap">
        SELECT g_id, G_TEAMID, G_TITLE, G_TAG, G_CREATEDATE, G_TIME, G_MINMEMBER, G_RESDATE, G_STATUS,
        G_USER_ID, S_ID, S_NUM,
        T_NAME, T_LOGO, T_REGION, T_PHONE, RANKSCORE, T_MINAGE, T_MAXAGE, T_MAXMEMBER, T_MEMBER, T_INFO,
        S_NAME, S_REGION, S_ADDR, S_OWNER, S_PHONE
        FROM (
        SELECT
        g.G_ID, g.G_TEAMID, g.G_TITLE, g.G_TAG, g.G_CREATEDATE, g.G_TIME, g.G_MINMEMBER, g.G_RESDATE, g.G_STATUS,
        g.T_USERID AS G_USER_ID, g.S_ID, g.S_NUM,
        t.T_NAME, t.T_LOGO, t.T_REGION, t.T_PHONE, t.RANKSCORE, t.T_MINAGE, t.T_MAXAGE, t.T_MAXMEMBER, t.T_MEMBER,
        t.T_INFO, t.CREATED_ID, t.CREATED_DATE, t.UPDATED_ID, t.UPDATED_DATE,
        s.S_NAME, s.S_REGION, s.S_ADDR, s.S_OWNER, s.S_PHONE,
        ROW_NUMBER() OVER (ORDER BY g.G_CREATEDATE DESC) AS rn
        FROM GAME g
        INNER JOIN TEAM t ON g.G_TEAMID = t.T_ID
        INNER JOIN STADIUM s ON g.S_ID = s.S_ID
        INNER JOIN REGIONCODE r ON s.S_REGION = r.region_name
        WHERE 1=1
        AND g.G_TEAMID = #{tID}
        )
        WHERE rn BETWEEN 1 AND 5
    </select>
</mapper>